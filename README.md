# Файлы для итогового задания

Это простой TODO-планировщик на Go с SQLite и готовым фронтендом из папки web. Сервер отдаёт статику и работает как REST API: можно добавлять задачи, получать список, читать одну задачу, редактировать, отмечать выполненной и удалять.

Поддерживаются повторения: d N (каждые N дней), y (ежегодно), а также «звёздочки»: недели w 1..7 и месяцы m <дни 1..31,-1,-2> [месяцы 1..12]. Логика повторений делает минимум один шаг вперёд от стартовой даты, поэтому корректно обрабатываются случаи с 29 февраля и годами.

Структура проекта простая: main.go, папка web/, и код в pkg/ (подпапки server — запуск HTTP, api — обработчики, db — работа с SQLite). При старте сервер проверяет наличие файла БД, при отсутствии создаёт таблицу scheduler и индекс по дате.

Переменные окружения: TODO_PORT (порт, по умолчанию 7540), TODO_DBFILE (путь к БД, по умолчанию ./scheduler.db), TODO_PASSWORD (опционально включает аутентификацию). Если пароль задан, есть страница /login.html и эндпоинт POST /api/signin — сервер выдаёт JWT, фронт кладёт его в cookie token, а защищённые ручки проверяются middleware (если токена нет/невалиден — 401).

Кратко
Простой TODO-планировщик на Go + SQLite. Бэкенд раздаёт фронт из /web и реализует REST API: добавить/список/получить/редактировать/выполнить/удалить задачу. Все автотесты из /tests проходят.

Что сделано по шагам
1) Веб-сервер и статика (/web), порт по умолчанию 7540, можно через TODO_PORT.  
2) SQLite: таблица scheduler, индекс по date, автоинициализация. Путь к БД через TODO_DBFILE.  
3) NextDate: правила d N, y, + звёздочки w и m (включая -1/-2, месяцы). Есть /api/nextdate для проверки.  
4) POST /api/task (валидация дат/повторов).  
5) GET /api/tasks (+поиск по подстроке и по дате 02.01.2006).  
6) GET/PUT /api/task (чтение и редактирование).  
7) POST /api/task/done (перенос/удаление), DELETE /api/task.  
8) (Опц.) Аутентификация: TODO_PASSWORD включает /login.html, /api/signin (JWT в cookie token), middleware на /api/task*, /api/tasks.  
   Dockerfile: сборка образа, запуск с пробросом /data для БД.

Как запустить локально
go run .  
Открыть: http://localhost:7540/  
Переменные окружения:  
- TODO_PORT (по умолчанию 7540)  
- TODO_DBFILE (по умолчанию ./scheduler.db)  
- TODO_PASSWORD (опционально; для логина /login.html)

Как прогнать тесты
go test ./tests -v  
(Для проверки звёздочек можно включить флаги в tests/settings.go: FullNextDate=true, Search=true.)

Docker (опц.)
Сборка: docker build -t finalgo:latest .  
Запуск: docker run --rm -it -p 7540:7540 -v "$PWD/data:/data" -e TODO_PORT=7540 -e TODO_DBFILE=/data/scheduler.db finalgo:latest  
С паролем: добавить -e TODO_PASSWORD=12345 и открыть /login.html.

Примечания
— Для повторяемых задач done переносит дату, считая минимум один шаг вперёд от даты задачи (правильно для 29 февраля и годовых повторов).  
— Все тесты зелёные на чистых настройках.